# llm 운영하기

1. MLOps
    - devops의 개념을 머신러닝과 데이터 과학 분야로 확장한 방법론
    - 데이터 수집, 전처리, 모델 학습, 평가, 배포, 모니터링 등 머신러닝 프로젝트의 전 과정을 자동화하고 효율화
    - 모델의 재현성(Reproducibility)를 보장하는 것이 매우 중요하다.
        - 재현성: 이전에 수행된 ML워크플로 그대로 반복했을 때 동일한 모델을 얻을 수 있는 지 여부
    1. 데이터 관리
        1. 데이터 선택
        2. 전처리 방식
        3. 특성 공학(feature engineering)
        4. 사용 툴: DVC(Data Verion Control): 데이터 버전 관리 및 어떤 데이터셋으로 모델을 학습시켰는 지를 기록
    2. 실험 관리
        1. 어떤 모델을 사용할 지 결정
        2. 어떤 하이퍼파라미터를 사용할 지
        3. 사용 툴: MLflow, W&B
    3. 모델 저장소
        1. 여러 버전의 모델이 생성될 때 관리하기 위함
        2. 모델의 수명 주기 추적 관리, 문제 시 롤백 등 용이
        3. 메타 데이터를 통해 모델 정보 확인 가능
        4. 배포 과정 자동화 가능
        5. 사용 툴: MLflow 모델 저장소, AWS 세이지메이커 모델 저장소
    4. 모델 모니터링
        1. 시간에 흐름에 따라 입력 등이 변하면서 모델의 성능이 안 좋아지는 지를 모니터링 할 필요가 있음
        2. 운영 과정 중 모델 버전이 실수로 바뀌지 않았는 지
        3. 기본적인 지표로 시스템 문제 확인
        4. 사용 툴: 프로메테오수, 그라파나, AWS 세이지메이커 모델 모니터
2. LLMOps
    1. 상업용 모델과 오픈소스 모델
        
        
        |  | 상업용 모델 | 오픈소스 모델 |
        | --- | --- | --- |
        | 장점 | 쉽게 높은 성능의 모델을 활용할 수 있음 | 자유로운 미세 조정, 비교적 빠른 추론 속도 |
        | 단점 | 모델의 버전 변경에 따라 성능이 달라질 수 있음 | 직접 인프라를 관리해야 함 |
    2. 모델 최적화 방법의 변화
        1. LLM에선 사전 학습이 사실상 불가
        2. 상업용 모델을 사용 시엔 미세 조정을 제한되게 사용 가능할 수도 있음
        3. 오픈 소스 모델 자유롭게 조정 가능
    3. LLM 평가의 어려움
        1. ML모델은 정량적인 지표를 사용 가능하나 LLM에서는 어려움
3. LLM 평가하기
    1. 정량적 지표
        1. BLEU: 기계 번역의 결과와 사람이 번역한 결과의 유사도를 측정하여 번역성능 평가
            1. 문장의 유창성이나 문법적 오류는 반영하지 못 함
        2. ROUGE: 모델이 생성한 요약문과 사람이 생성한 참조 요약문 사이의 n그램 중복도로 측정
            1. 단어의 순서나 문장 구조를 고려하지 않음
        3. 펄플렉시티: 모델이 새로운 단어를 생성할 때의 불확실성을 수치화함
            1. 사람이 직관적으로 해석하기 어려움
    2. 벤치마크 데이터셋을 활용한 평가
        1. ARC, HellaSwag, MMLU 등이 있고, 문제를 얼마나 잘 이해서 잘 답변할 수 있는 지를 평가
        2. 한국에선 한국어 LLM 리더보드를 제공하고 있음
    3. 사람이 직접 평가: 언어의 유창성 등을 평가할 수 있으나 비싸다
    4. LLM을 통한 평가: 여러 LLM에게 멀티 턴 질문을 한 답변을 챗봇 아레나 데이터를 활용해서 평가. 인간의 평가와 80% 수준으로 일치함
    5. RAG평가
        1. 신뢰성: 생성된 응답이 검색된 맥락 데이터에 얼마나 사실적으로 부합하는 지 평가
        2. 답변 관련성: 생성된 답변이 요청과 얼마나 관련성이 있는 지 평가
        3. 맥락 관련성: 검색 결과인 맥락 데이터가 요청과 얼마나 관련이 있는 지 평가

# DVC

git 을 활용해서 원본 데이터는 따로 저장하고, 데이터가 변경된 부분의 메타데이터만 git으로 관리하는 방식

git 명령어를 잘 알아야 함

1. git init; dvc init: 초기화

    ![1](https://github.com/user-attachments/assets/702c76a6-e9a5-4d88-829c-ed38c9d0bc69)

2. dvc add 데이터 : dvc에서 관리할 data를 추가
3. git add dvc/data.dvc dvc/.gitignore; git commit “message” : dvc 파일 추적 및 gitignore 등록 (원본 데이터는 git에 등록이 안 되게 됨)
    
    ![2](https://github.com/user-attachments/assets/e528cf08-4eb1-425d-91c0-309cd08ac818)
   
5. dvc 파일 내용 확인: md5, 크기, 개수

    ![3](https://github.com/user-attachments/assets/274d1724-e64c-4208-82cb-ce0e8fffe6f9)

5. 파일 변경 후 dvc add 하여 변경 사항 저장 (git add 와 동일)
    
    ![4](https://github.com/user-attachments/assets/a8dcb9a1-0955-4092-ae1c-f80e4285c711)
   
7. 파일 확인 후 이전 버전 불러오기
    
    ![5](https://github.com/user-attachments/assets/2920322b-40af-4274-a4f3-1bf0aefe6718)
   
7. 원격 저장소 등록 (여기서는 로컬에 폴더 생성)
    
    ![6](https://github.com/user-attachments/assets/7b42ff38-3159-4013-82b0-425c62e2d747)
   
9. dvc push → 원격 저장소에 변경 분 저장

    ![7](https://github.com/user-attachments/assets/cf98f819-10ed-49ac-b3bb-2d6353e6782c)
  
